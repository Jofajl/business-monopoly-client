<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Monopoly - T-Level Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        /* CSS Variables */
        :root {
            --black: #080808;
            --brown: #640303;
            --board: #fafaf8;
            --dark-purple: #5e3577;
            --light-blue: #d2eaf5;
            --purple: #b02f7c;
            --orange: #fa811d;
            --red: #f50c2b;
            --yellow: #ffed20;
            --green: #41994e;
            --dark-blue: #5a6dba;
        }

        /* Global Styles */
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Oswald', sans-serif;
            font-weight: 400;
            font-size: 10px;
            color: var(--black);
            text-transform: uppercase;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        h1, h2, h3, h4, h5, h6 {
            margin: 0;
        }

        /* Property Colors */
        .dark-purple { background: var(--dark-purple); }
        .light-blue { background: var(--light-blue); }
        .purple { background: var(--purple); }
        .orange { background: var(--orange); }
        .red { background: var(--red); }
        .yellow { background: var(--yellow); }
        .green { background: var(--green); }
        .dark-blue { background: var(--dark-blue); }

        /* Game Container */
        .game-container {
            max-width: 1400px;
            width: 100%;
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        .game-container.single-column {
            flex-direction: column;
            align-items: center;
        }

        /* Board Layout */
        .table {
            padding: 20px;
        }

        .board {
            display: grid;
            grid-template-columns: 125px repeat(9, 80px) 125px;
            grid-template-rows: 125px repeat(9, 80px) 125px;
            grid-gap: 2px;
            width: 994px;
            height: 994px;
            background: var(--black);
            border: 2px solid var(--black);
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* Center Area */
        .center {
            grid-column: 2 / 11;
            grid-row: 2 / 11;
            background: var(--board);
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(7, 1fr);
            justify-items: center;
            align-items: center;
            border-radius: 8px;
        }

        .title {
            grid-column: 1 / 8;
            grid-row: 3 / 4;
            font-size: 48px;
            font-weight: 600;
            letter-spacing: 8px;
            color: var(--red);
            text-align: center;
        }

        .business-subtitle {
            grid-column: 1 / 8;
            grid-row: 4 / 5;
            font-size: 16px;
            font-weight: 400;
            letter-spacing: 2px;
            color: var(--black);
            text-align: center;
        }

        .turn-indicator {
            grid-column: 1 / 8;
            grid-row: 5 / 6;
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            text-align: center;
            font-size: 14px;
            letter-spacing: 1px;
        }

        /* Rows of spaces */
        .row {
            display: grid;
            grid-gap: 2px;
        }

        .horizontal-row {
            grid-template-columns: repeat(9, 80px);
            grid-template-rows: 125px;
        }

        .vertical-row {
            grid-template-columns: 125px;
            grid-template-rows: repeat(9, 80px);
        }

        .vertical-row .container {
            top: 50%;
            left: 50%;
        }

        .bottom-row {
            grid-column: 2 / 11;
            grid-row: 11;
        }

        .left-row {
            grid-column: 1;
            grid-row: 2 / 11;
        }

        .left-row .container {
            transform: translate(-50%, -50%) rotate(90deg);
        }

        .top-row {
            grid-column: 2 / 11;
            grid-row: 1;
        }

        .top-row .container {
            transform: rotate(180deg);
        }

        .right-row {
            grid-column: 11;
            grid-row: 2 / 11;
        }

        .right-row .container {
            transform: translate(-50%, -50%) rotate(270deg);
        }

        /* Spaces */
        .space {
            background: var(--board);
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .space:hover {
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            transform-origin: center;
            height: 125px;
            width: 80px;
            padding: 5px;
        }

        .name,
        .instructions {
            padding-left: 8px;
            padding-right: 8px;
            font-size: 9px;
            line-height: 1.2;
        }

        .price {
            font-size: 7px;
            font-weight: 400;
            padding-bottom: 5px;
        }

        /* Corner Spaces */
        .corner .container {
            justify-content: space-around;
            height: 100%;
            width: 100%;
        }

        .corner .name {
            padding: 0;
            font-size: 12px;
            font-weight: 600;
        }

        /* Property Spaces */
        .property .color-bar {
            height: 25px;
            border-bottom: 2px solid var(--black);
        }

        .property .name {
            padding-bottom: 40px;
            font-weight: 500;
        }

        /* Specific Corners */
        .go {
            grid-column: 11;
            grid-row: 11;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border-radius: 0 0 10px 0;
        }

        .go .container {
            justify-content: center;
            transform: rotate(315deg);
        }

        .go .go-word {
            font-size: 36px;
            color: white;
            font-weight: 600;
        }

        .jail {
            grid-column: 1;
            grid-row: 11;
            background: linear-gradient(45deg, #ffa500, #ffb84d);
            border-radius: 0 0 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .jail .name {
            font-size: 16px;
            font-weight: 600;
            color: white;
        }

        .free-parking {
            grid-column: 1;
            grid-row: 1;
            background: linear-gradient(45deg, #4ecdc4, #6ed0ca);
            border-radius: 10px 0 0 0;
        }

        .free-parking .container {
            justify-content: center;
            transform: rotate(135deg);
        }

        .free-parking .name {
            font-size: 14px;
            color: white;
            font-weight: 600;
        }

        .go-to-jail {
            grid-column: 11;
            grid-row: 1;
            background: linear-gradient(45deg, #ff4757, #ff6b7a);
            border-radius: 0 10px 0 0;
        }

        .go-to-jail .container {
            justify-content: center;
            transform: rotate(225deg);
        }

        .go-to-jail .name {
            font-size: 12px;
            color: white;
            font-weight: 600;
        }

        /* Special Spaces */
        .chance .container,
        .community-chest .container {
            justify-content: center;
        }

        .chance .drawing {
            font-size: 40px;
            color: var(--red);
        }

        .community-chest .drawing {
            font-size: 30px;
            color: var(--light-blue);
        }

        .railroad .drawing,
        .utility .drawing {
            font-size: 30px;
            color: var(--black);
        }

        /* Player Pieces */
        .player-piece {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
            z-index: 100;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            cursor: pointer;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .player-piece:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        }

        .player-piece.moving {
            animation: bounce 0.5s ease-in-out;
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
        }

        @keyframes bounce {
            0%, 100% { transform: translate(-50%, -50%) scale(1.2); }
            50% { transform: translate(-50%, -50%) scale(1.4); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .player-piece-0 { background: #ff6b6b; }
        .player-piece-1 { background: #4ecdc4; }
        .player-piece-2 { background: #45b7d1; }
        .player-piece-3 { background: #f39c12; }
        .player-piece-4 { background: #9b59b6; }
        .player-piece-5 { background: #e74c3c; }

        /* Game Panel */
        .game-panel {
            width: 350px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 994px;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .panel-section h3 {
            margin-bottom: 15px;
            color: #2c5f2d;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
            font-size: 16px;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            font-size: 12px;
        }

        .player-item.current {
            border-left-color: #ff6b6b;
            background: #fff5f5;
        }

        .player-money {
            font-weight: bold;
            color: #27ae60;
        }

        .game-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .dice-result {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #ddd;
        }

        /* Card Display */
        .card-item {
            padding: 8px;
            margin: 5px 0;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            font-size: 11px;
            text-transform: none;
            border-left: 4px solid #f39c12;
        }

        .card-item.chance {
            background: #ffeef0;
            border-color: #ffccd5;
            border-left-color: var(--red);
        }

        .card-item.community {
            background: #e8f4fd;
            border-color: #b3d9ff;
            border-left-color: var(--light-blue);
        }

        /* Special Space Animation */
        .space.special-landed {
            animation: specialGlow 2s ease-in-out;
        }

        @keyframes specialGlow {
            0%, 100% { box-shadow: none; }
            50% { box-shadow: 0 0 30px #ffd700; }
        }

        .dice {
            width: 60px;
            height: 60px;
            background: white;
            border: 3px solid var(--black);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            position: relative;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .dice:hover {
            transform: scale(1.1);
        }

        .dice.rolling {
            animation: diceRoll 2s ease-in-out;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border-color: var(--red);
        }

        @keyframes diceRoll {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            25% { transform: rotateX(90deg) rotateY(180deg); }
            50% { transform: rotateX(180deg) rotateY(360deg); }
            75% { transform: rotateX(270deg) rotateY(180deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }

        .dice-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .dice-total {
            font-size: 16px;
            font-weight: bold;
            color: var(--red);
            margin: 10px 0;
            padding: 8px 16px;
            background: #f8f9fa;
            border-radius: 20px;
            border: 2px solid var(--red);
        }

        /* Question Modal */
        .question-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .question-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .question-content.bonus-chance {
            background: linear-gradient(135deg, #fff5f5, #ffe8e8);
            border: 3px solid var(--red);
        }

        .question-content.bonus-community {
            background: linear-gradient(135deg, #f0f8ff, #e8f4fd);
            border: 3px solid var(--light-blue);
        }

        .question-title {
            color: var(--red);
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
        }

        .bonus-reward {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            border: 2px solid #c3e6cb;
        }

        .question-text {
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.6;
            text-transform: none;
            color: #333;
        }

        .question-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .question-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            text-transform: none;
            font-size: 14px;
        }

        .question-option:hover {
            border-color: #4CAF50;
            background: #e8f5e8;
            transform: translateY(-2px);
        }

        .timer {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .timer-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 4px solid #ddd;
            border-top: 4px solid #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Card Modal */
        .card-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .card-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .card-content.chance {
            background: linear-gradient(135deg, #fff5f5, #ffe8e8);
            border: 3px solid var(--red);
        }

        .card-content.community {
            background: linear-gradient(135deg, #f0f8ff, #e8f4fd);
            border: 3px solid var(--light-blue);
        }

        .card-title {
            font-size: 28px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .card-text {
            font-size: 18px;
            line-height: 1.6;
            text-transform: none;
            color: #333;
            margin-bottom: 20px;
        }

        /* Room Setup */
        .room-setup {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 400px;
            margin: 0 auto;
        }

        .room-setup h1 {
            color: #2c5f2d;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
            text-transform: none;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .room-actions {
            display: flex;
            gap: 10px;
        }

        .room-code-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .room-code {
            font-size: 24px;
            font-weight: bold;
            color: #2c5f2d;
            letter-spacing: 2px;
        }

        .hidden {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .game-container {
                flex-direction: column;
                align-items: center;
            }
            
            .board {
                width: 700px;
                height: 700px;
                grid-template-columns: 90px repeat(9, 55px) 90px;
                grid-template-rows: 90px repeat(9, 55px) 90px;
            }

            .container {
                height: 90px;
                width: 55px;
            }
            
            .game-panel {
                width: 100%;
                max-width: 700px;
            }
        }

        @media (max-width: 768px) {
            .board {
                width: 500px;
                height: 500px;
                grid-template-columns: 65px repeat(9, 40px) 65px;
                grid-template-rows: 65px repeat(9, 40px) 65px;
            }

            .container {
                height: 65px;
                width: 40px;
            }
            
            .name {
                font-size: 7px !important;
            }

            .price {
                font-size: 6px !important;
            }
        }
    </style>
</head>
<body>
    <div id="room-setup" class="room-setup">
        <h1>🎓 Business Monopoly</h1>
        <p style="margin-bottom: 30px; color: #666; text-transform: none;">T-Level Business Education Game</p>
        
        <div class="input-group">
            <label for="playerName">Your Name:</label>
            <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
        </div>
        
        <div class="room-actions">
            <button class="btn btn-primary" onclick="createRoom()">Create Room</button>
            <button class="btn btn-secondary" onclick="showJoinForm()">Join Room</button>
        </div>
        
        <div id="join-form" class="hidden" style="margin-top: 20px;">
            <div class="input-group">
                <label for="roomCode">Room Code:</label>
                <input type="text" id="roomCode" placeholder="Enter room code" maxlength="6">
            </div>
            <button class="btn btn-primary" onclick="joinRoom()">Join Game</button>
        </div>
        
        <div id="room-created" class="hidden">
            <div class="room-code-display">
                <p style="text-transform: none;">Share this code with other players:</p>
                <div id="room-code" class="room-code"></div>
            </div>
            <div id="waiting-players"></div>
            <button id="start-game-btn" class="btn btn-primary hidden" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <div id="game-container" class="game-container hidden">
        <div class="table">
            <div class="board">
                <!-- Center -->
                <div class="center">
                    <div class="title">BUSINESS</div>
                    <div class="business-subtitle">MONOPOLY</div>
                    <div id="turn-indicator" class="turn-indicator">Waiting to start...</div>
                </div>

                <!-- Corner: GO -->
                <div class="space corner go" data-index="0">
                    <div class="container">
                        <div class="name">Collect £200</div>
                        <div class="go-word">GO</div>
                    </div>
                </div>

                <!-- Bottom Row (Moving LEFT from GO) -->
                <div class="row horizontal-row bottom-row">
                    <div class="space property" data-index="9">
                        <div class="container">
                            <div class="color-bar light-blue"></div>
                            <div class="name">Pentonville</div>
                            <div class="price">£120</div>
                        </div>
                    </div>
                    <div class="space property" data-index="8">
                        <div class="container">
                            <div class="color-bar light-blue"></div>
                            <div class="name">Euston Road</div>
                            <div class="price">£100</div>
                        </div>
                    </div>
                    <div class="space chance" data-index="7">
                        <div class="container">
                            <div class="name">Chance</div>
                            <i class="drawing fa fa-question"></i>
                        </div>
                    </div>
                    <div class="space property" data-index="6">
                        <div class="container">
                            <div class="color-bar light-blue"></div>
                            <div class="name">Angel</div>
                            <div class="price">£100</div>
                        </div>
                    </div>
                    <div class="space railroad" data-index="5">
                        <div class="container">
                            <div class="name">King's Cross</div>
                            <i class="drawing fa fa-subway"></i>
                            <div class="price">£200</div>
                        </div>
                    </div>
                    <div class="space fee" data-index="4">
                        <div class="container">
                            <div class="name">Income Tax</div>
                            <div class="instructions">Pay £200</div>
                        </div>
                    </div>
                    <div class="space property" data-index="3">
                        <div class="container">
                            <div class="color-bar dark-purple"></div>
                            <div class="name">Whitechapel</div>
                            <div class="price">£60</div>
                        </div>
                    </div>
                    <div class="space community-chest" data-index="2">
                        <div class="container">
                            <div class="name">Community</div>
                            <i class="drawing fa fa-cube"></i>
                        </div>
                    </div>
                    <div class="space property" data-index="1">
                        <div class="container">
                            <div class="color-bar dark-purple"></div>
                            <div class="name">Old Kent Rd</div>
                            <div class="price">£60</div>
                        </div>
                    </div>
                </div>

                <!-- Corner: Jail -->
                <div class="space corner jail" data-index="10">
                    <div class="name">Jail</div>
                </div>

                <!-- Left Row (Moving UP from Jail to Free Parking) -->
                <div class="row vertical-row left-row">
                    <div class="space property" data-index="19">
                        <div class="container">
                            <div class="color-bar orange"></div>
                            <div class="name">Vine Street</div>
                            <div class="price">£200</div>
                        </div>
                    </div>
                    <div class="space property" data-index="18">
                        <div class="container">
                            <div class="color-bar orange"></div>
                            <div class="name">Marlborough</div>
                            <div class="price">£180</div>
                        </div>
                    </div>
                    <div class="space community-chest" data-index="17">
                        <div class="container">
                            <div class="name">Community</div>
                            <i class="drawing fa fa-cube"></i>
                        </div>
                    </div>
                    <div class="space property" data-index="16">
                        <div class="container">
                            <div class="color-bar orange"></div>
                            <div class="name">Bow Street</div>
                            <div class="price">£180</div>
                        </div>
                    </div>
                    <div class="space railroad" data-index="15">
                        <div class="container">
                            <div class="name">Marylebone</div>
                            <i class="drawing fa fa-subway"></i>
                            <div class="price">£200</div>
                        </div>
                    </div>
                    <div class="space property" data-index="14">
                        <div class="container">
                            <div class="color-bar purple"></div>
                            <div class="name">Northumberland</div>
                            <div class="price">£160</div>
                        </div>
                    </div>
                    <div class="space property" data-index="13">
                        <div class="container">
                            <div class="color-bar purple"></div>
                            <div class="name">Whitehall</div>
                            <div class="price">£140</div>
                        </div>
                    </div>
                    <div class="space utility" data-index="12">
                        <div class="container">
                            <div class="name">Electric Co</div>
                            <i class="drawing fa fa-lightbulb-o"></i>
                            <div class="price">£150</div>
                        </div>
                    </div>
                    <div class="space property" data-index="11">
                        <div class="container">
                            <div class="color-bar purple"></div>
                            <div class="name">Pall Mall</div>
                            <div class="price">£140</div>
                        </div>
                    </div>
                </div>

                <!-- Corner: Free Parking -->
                <div class="space corner free-parking" data-index="20">
                    <div class="container">
                        <div class="name">Free</div>
                        <i class="fa fa-car" style="font-size: 30px; color: white;"></i>
                        <div class="name">Parking</div>
                    </div>
                </div>

                <!-- Top Row (Moving RIGHT from Free Parking to Go to Jail) -->
                <div class="row horizontal-row top-row">
                    <div class="space property" data-index="21">
                        <div class="container">
                            <div class="color-bar red"></div>
                            <div class="name">The Strand</div>
                            <div class="price">£220</div>
                        </div>
                    </div>
                    <div class="space chance" data-index="22">
                        <div class="container">
                            <div class="name">Chance</div>
                            <i class="drawing fa fa-question"></i>
                        </div>
                    </div>
                    <div class="space property" data-index="23">
                        <div class="container">
                            <div class="color-bar red"></div>
                            <div class="name">Fleet Street</div>
                            <div class="price">£220</div>
                        </div>
                    </div>
                    <div class="space property" data-index="24">
                        <div class="container">
                            <div class="color-bar red"></div>
                            <div class="name">Trafalgar</div>
                            <div class="price">£240</div>
                        </div>
                    </div>
                    <div class="space railroad" data-index="25">
                        <div class="container">
                            <div class="name">Fenchurch St</div>
                            <i class="drawing fa fa-subway"></i>
                            <div class="price">£200</div>
                        </div>
                    </div>
                    <div class="space property" data-index="26">
                        <div class="container">
                            <div class="color-bar yellow"></div>
                            <div class="name">Leicester Sq</div>
                            <div class="price">£260</div>
                        </div>
                    </div>
                    <div class="space property" data-index="27">
                        <div class="container">
                            <div class="color-bar yellow"></div>
                            <div class="name">Coventry St</div>
                            <div class="price">£260</div>
                        </div>
                    </div>
                    <div class="space utility" data-index="28">
                        <div class="container">
                            <div class="name">Water Works</div>
                            <i class="drawing fa fa-tint"></i>
                            <div class="price">£150</div>
                        </div>
                    </div>
                    <div class="space property" data-index="29">
                        <div class="container">
                            <div class="color-bar yellow"></div>
                            <div class="name">Piccadilly</div>
                            <div class="price">£280</div>
                        </div>
                    </div>
                </div>

                <!-- Corner: Go to Jail -->
                <div class="space corner go-to-jail" data-index="30">
                    <div class="container">
                        <div class="name">Go To</div>
                        <i class="fa fa-gavel" style="font-size: 30px; color: white;"></i>
                        <div class="name">Jail</div>
                    </div>
                </div>

                <!-- Right Row (Moving DOWN from Go to Jail to GO) -->
                <div class="row vertical-row right-row">
                    <div class="space property" data-index="31">
                        <div class="container">
                            <div class="color-bar green"></div>
                            <div class="name">Regent St</div>
                            <div class="price">£300</div>
                        </div>
                    </div>
                    <div class="space property" data-index="32">
                        <div class="container">
                            <div class="color-bar green"></div>
                            <div class="name">Oxford St</div>
                            <div class="price">£300</div>
                        </div>
                    </div>
                    <div class="space community-chest" data-index="33">
                        <div class="container">
                            <div class="name">Community</div>
                            <i class="drawing fa fa-cube"></i>
                        </div>
                    </div>
                    <div class="space property" data-index="34">
                        <div class="container">
                            <div class="color-bar green"></div>
                            <div class="name">Bond Street</div>
                            <div class="price">£320</div>
                        </div>
                    </div>
                    <div class="space railroad" data-index="35">
                        <div class="container">
                            <div class="name">Liverpool St</div>
                            <i class="drawing fa fa-subway"></i>
                            <div class="price">£200</div>
                        </div>
                    </div>
                    <div class="space chance" data-index="36">
                        <div class="container">
                            <div class="name">Chance</div>
                            <i class="drawing fa fa-question"></i>
                        </div>
                    </div>
                    <div class="space property" data-index="37">
                        <div class="container">
                            <div class="color-bar dark-blue"></div>
                            <div class="name">Park Lane</div>
                            <div class="price">£350</div>
                        </div>
                    </div>
                    <div class="space fee" data-index="38">
                        <div class="container">
                            <div class="name">Super Tax</div>
                            <div class="instructions">Pay £100</div>
                        </div>
                    </div>
                    <div class="space property" data-index="39">
                        <div class="container">
                            <div class="color-bar dark-blue"></div>
                            <div class="name">Mayfair</div>
                            <div class="price">£400</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="game-panel">
            <div class="panel-section">
                <h3>👥 Players</h3>
                <div id="players-list" class="players-list"></div>
            </div>
            
            <div class="panel-section">
                <h3>🎮 Game Controls</h3>
                <div id="game-controls" class="game-controls">
                    <button id="start-turn-btn" class="btn btn-primary" onclick="startTurn()">Start Turn</button>
                    <button id="roll-dice-btn" class="btn btn-primary hidden" onclick="rollDice()">Roll Dice</button>
                    <button id="buy-property-btn" class="btn btn-secondary hidden" onclick="buyProperty()">Buy Property</button>
                    <button id="end-turn-btn" class="btn btn-danger hidden" onclick="endTurn()">End Turn</button>
                </div>
                <div id="dice-result" class="dice-result hidden"></div>
            </div>
            
            <div class="panel-section">
                <h3>📊 Statistics</h3>
                <div id="stats-display"></div>
            </div>
            
            <div class="panel-section">
                <h3>🏠 Properties</h3>
                <div id="properties-list">No properties owned</div>
            </div>

            <div class="panel-section">
                <h3>🃏 Cards</h3>
                <div id="cards-list">No cards held</div>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="question-modal" class="question-modal hidden">
        <div class="question-content">
            <h2 id="question-title" class="question-title">📚 Business Question</h2>
            <div id="timer" class="timer">
                <div class="timer-circle">
                    <span id="timer-value">30</span>
                </div>
            </div>
            <div id="question-text" class="question-text"></div>
            <div id="question-options" class="question-options"></div>
            <div id="question-result" class="hidden"></div>
        </div>
    </div>

    <!-- Card Modal -->
    <div id="card-modal" class="card-modal hidden">
        <div id="card-content" class="card-content">
            <h2 id="card-title" class="card-title">🃏 Card Drawn</h2>
            <div id="card-text" class="card-text"></div>
            <div id="card-action-text" style="margin-top: 20px; font-size: 14px; color: #666;"></div>
        </div>
    </div>

    <script>
        // Game state variables
        let currentRoom = null;
        let currentPlayer = null;
        let gameData = null;
        let canBuyProperty = false;
        let propertyToBuy = null;
        let isPlayerMoving = false;

        // Enhanced Chance and Community Chest Cards
        const chanceCards = [
            { text: "Advance to GO - Collect £200", action: "moveToGo" },
            { text: "Go to Jail - Go directly to Jail", action: "goToJail" },
            { text: "Advance to Trafalgar Square", action: "moveTo", position: 24 },
            { text: "Advance to Mayfair", action: "moveTo", position: 39 },
            { text: "Advance to nearest Railway Station and pay owner twice the rental", action: "moveToNearestRailway" },
            { text: "Go back 3 spaces", action: "moveBack", spaces: 3 },
            { text: "Pay poor tax of £15", action: "payMoney", amount: 15 },
            { text: "Your building loan matures - Collect £150", action: "receiveMoney", amount: 150 },
            { text: "You have won a crossword competition - Collect £100", action: "receiveMoney", amount: 100 },
            { text: "Bank pays you dividend of £50", action: "receiveMoney", amount: 50 },
            { text: "Get out of Jail Free - Keep until needed", action: "getOutOfJail" },
            { text: "Advance to Pall Mall", action: "moveTo", position: 11 },
            { text: "Take a trip to King's Cross Station", action: "moveTo", position: 5 },
            { text: "Make general repairs on all your houses - £25 per house", action: "propertyRepairs", amount: 25 },
            { text: "Move forward to the nearest Utility", action: "moveToNearestUtility" }
        ];

        const communityChestCards = [
            { text: "Advance to GO - Collect £200", action: "moveToGo" },
            { text: "Go to Jail - Go directly to Jail", action: "goToJail" },
            { text: "Doctor's fee - Pay £50", action: "payMoney", amount: 50 },
            { text: "From sale of stock you get £50", action: "receiveMoney", amount: 50 },
            { text: "Holiday fund matures - Receive £100", action: "receiveMoney", amount: 100 },
            { text: "Income tax refund - Collect £20", action: "receiveMoney", amount: 20 },
            { text: "Get out of Jail Free - Keep until needed", action: "getOutOfJail" },
            { text: "Life insurance matures - Collect £100", action: "receiveMoney", amount: 100 },
            { text: "Hospital fees - Pay £100", action: "payMoney", amount: 100 },
            { text: "School fees - Pay £50", action: "payMoney", amount: 50 },
            { text: "Receive £25 consultancy fee", action: "receiveMoney", amount: 25 },
            { text: "You have won second prize in a beauty contest - Collect £10", action: "receiveMoney", amount: 10 },
            { text: "You inherit £100", action: "receiveMoney", amount: 100 },
            { text: "Pay hospital fees of £100", action: "payMoney", amount: 100 },
            { text: "Pay school fees of £150", action: "payMoney", amount: 150 },
            { text: "Receive £50 from sale of stock", action: "receiveMoney", amount: 50 }
        ];

        function drawRandomCard(cardType) {
            const cards = cardType === 'chance' ? chanceCards : communityChestCards;
            return cards[Math.floor(Math.random() * cards.length)];
        }

        function showCardModal(title, text, cardType, actionText = "Card effect will be applied automatically...") {
            const modal = document.getElementById('card-modal');
            const content = document.getElementById('card-content');
            
            modal.classList.remove('hidden');
            document.getElementById('card-title').textContent = title;
            document.getElementById('card-text').textContent = text;
            document.getElementById('card-action-text').textContent = actionText;
            
            // Style based on card type
            content.className = `card-content ${cardType}`;
            
            // Auto-close after 4 seconds
            setTimeout(() => {
                hideCardModal();
            }, 4000);
        }

        function hideCardModal() {
            document.getElementById('card-modal').classList.add('hidden');
        }

        function executeCardAction(playerIndex, card) {
            if (!gameData || !gameData.players[playerIndex]) return;
            
            const player = gameData.players[playerIndex];
            const currentPosition = player.position;
            
            console.log(`Executing card action: ${card.action}`, card);
            
            switch(card.action) {
                case 'moveToGo':
                    movePlayerTo(playerIndex, 0);
                    player.money += 200;
                    showMessage('🎯 Moved to GO! Collect £200', 'success');
                    break;
                    
                case 'goToJail':
                    handleGoToJail(playerIndex);
                    break;
                    
                case 'moveTo':
                    movePlayerTo(playerIndex, card.position);
                    // Check if player passed GO
                    if (card.position < currentPosition) {
                        player.money += 200;
                        showMessage('🎯 Passed GO! Collect £200', 'success');
                    }
                    break;
                    
                case 'moveBack':
                    const newPos = Math.max(0, currentPosition - card.spaces);
                    movePlayerTo(playerIndex, newPos);
                    break;
                    
                case 'moveToNearestRailway':
                    const railways = [5, 15, 25, 35]; // Railway positions
                    let nearestRailway = railways.find(pos => pos > currentPosition);
                    if (!nearestRailway) nearestRailway = railways[0]; // Wrap around to first railway
                    
                    movePlayerTo(playerIndex, nearestRailway);
                    if (nearestRailway < currentPosition) {
                        player.money += 200; // Passed GO
                        showMessage('🎯 Passed GO! Collect £200', 'success');
                    }
                    showMessage('🚂 Moved to nearest Railway Station', 'info');
                    break;
                    
                case 'moveToNearestUtility':
                    const utilities = [12, 28]; // Electric Company and Water Works
                    let nearestUtility = utilities.find(pos => pos > currentPosition);
                    if (!nearestUtility) nearestUtility = utilities[0]; // Wrap around
                    
                    movePlayerTo(playerIndex, nearestUtility);
                    if (nearestUtility < currentPosition) {
                        player.money += 200; // Passed GO
                        showMessage('🎯 Passed GO! Collect £200', 'success');
                    }
                    showMessage('⚡ Moved to nearest Utility', 'info');
                    break;
                    
                case 'payMoney':
                    player.money = Math.max(0, player.money - card.amount);
                    showMessage(`💰 Pay £${card.amount}`, 'error');
                    break;
                    
                case 'receiveMoney':
                    player.money += card.amount;
                    showMessage(`💰 Receive £${card.amount}`, 'success');
                    break;
                    
                case 'getOutOfJail':
                    if (!player.cards) player.cards = [];
                    player.cards.push({ type: 'Get Out of Jail Free', text: card.text });
                    showMessage('🔓 Get Out of Jail Free card added!', 'info');
                    updateCardsDisplay();
                    break;
                    
                case 'propertyRepairs':
                    // Simplified: just charge per property owned
                    const repairCost = player.properties.length * card.amount;
                    player.money = Math.max(0, player.money - repairCost);
                    showMessage(`🔧 Property repairs: £${repairCost}`, 'error');
                    break;
            }
            
            updatePlayersDisplay(gameData.players);
        }

        function movePlayerTo(playerIndex, targetPosition) {
            if (!gameData || !gameData.players[playerIndex]) return;
            
            const player = gameData.players[playerIndex];
            const currentPosition = player.position;
            
            console.log(`Moving player ${playerIndex} from ${currentPosition} to ${targetPosition}`);
            
            // Calculate the number of steps needed
            let steps;
            if (targetPosition >= currentPosition) {
                steps = targetPosition - currentPosition;
            } else {
                // Going around the board
                steps = (40 - currentPosition) + targetPosition;
            }
            
            // Start the animation
            isPlayerMoving = true;
            animatePlayerMovement(playerIndex, currentPosition, targetPosition, steps);
        }

        function handleChance(playerIndex) {
            const card = drawRandomCard('chance');
            console.log('Chance card drawn:', card);
            
            // Show message to all players about the card being drawn
            const playerName = gameData.players[playerIndex]?.name || 'Player';
            showMessage(`${playerName} drew a Chance card!`, 'info');
            
            showCardModal('❓ Chance Card', card.text, 'chance');
            
            // Execute card action after showing modal
            setTimeout(() => {
                executeCardAction(playerIndex, card);
            }, 2000);
        }

        function handleCommunityChest(playerIndex) {
            const card = drawRandomCard('community');
            console.log('Community Chest card drawn:', card);
            
            // Show message to all players about the card being drawn
            const playerName = gameData.players[playerIndex]?.name || 'Player';
            showMessage(`${playerName} drew a Community Chest card!`, 'info');
            
            showCardModal('📦 Community Chest', card.text, 'community');
            
            // Execute card action after showing modal
            setTimeout(() => {
                executeCardAction(playerIndex, card);
            }, 2000);
        }

        // Enhanced player movement animation
        function animatePlayerMovement(playerIndex, fromPosition, toPosition, totalSteps) {
            const piece = document.getElementById(`player-${playerIndex}`);
            if (!piece) {
                console.error(`Player piece not found: player-${playerIndex}`);
                return;
            }

            console.log(`Animating player ${playerIndex} movement: ${fromPosition} → ${toPosition} (${totalSteps} steps)`);

            let currentPosition = fromPosition;
            let stepsRemaining = totalSteps;
            let passedGo = false;

            // Highlight destination
            const destinationSquare = document.querySelector(`[data-index="${toPosition}"]`);
            if (destinationSquare) {
                destinationSquare.style.boxShadow = '0 0 25px #FFD700';
                destinationSquare.style.border = '3px solid #FFD700';
                destinationSquare.style.transform = 'scale(1.05)';
                destinationSquare.style.zIndex = '50';
            }

            function moveOneStep() {
                if (stepsRemaining <= 0) {
                    console.log(`Movement complete. Final position: ${currentPosition}`);
                    
                    // Clear movement flag
                    isPlayerMoving = false;
                    
                    // Update game data with final position
                    if (gameData && gameData.players[playerIndex]) {
                        gameData.players[playerIndex].position = toPosition;
                    }
                    
                    // Clear destination highlighting
                    if (destinationSquare) {
                        destinationSquare.style.boxShadow = '';
                        destinationSquare.style.border = '';
                        destinationSquare.style.transform = '';
                        destinationSquare.style.zIndex = '';
                    }
                    
                    // Remove moving animation
                    piece.classList.remove('moving');
                    
                    // Handle special spaces after movement completes
                    setTimeout(() => {
                        handleSpecialSpace(playerIndex, toPosition);
                        updateGameControls();
                        updatePlayersDisplay(gameData.players);
                    }, 500);
                    
                    return;
                }

                // Calculate next position (clockwise around board)
                currentPosition = (currentPosition + 1) % 40;
                stepsRemaining--;

                console.log(`Moving to position ${currentPosition}, ${stepsRemaining} steps remaining`);

                // Check if passing GO
                if (currentPosition === 0 && stepsRemaining > 0) {
                    passedGo = true;
                    console.log('Passed GO!');
                    showMessage('🎯 Passed GO! Collect £200', 'success');
                    if (gameData && gameData.players[playerIndex]) {
                        gameData.players[playerIndex].money += 200;
                    }
                }

                // Move piece to new position
                const newProperty = document.querySelector(`[data-index="${currentPosition}"]`);
                if (newProperty) {
                    // Remove piece from current location
                    piece.remove();
                    
                    // Add to new location
                    newProperty.appendChild(piece);
                    
                    // Reset positioning
                    piece.style.left = '50%';
                    piece.style.top = '50%';
                    piece.style.transform = 'translate(-50%, -50%)';
                    
                    // Add moving animation
                    piece.classList.add('moving');
                    
                    // Continue to next step after delay
                    setTimeout(() => {
                        moveOneStep();
                    }, 600); // Slightly faster movement
                } else {
                    console.error(`Could not find property element for position ${currentPosition}`);
                    // Continue anyway
                    setTimeout(moveOneStep, 600);
                }
            }

            // Start the movement
            moveOneStep();
        }

        function handleSpecialSpace(playerIndex, position) {
            const space = document.querySelector(`[data-index="${position}"]`);
            if (space) {
                space.classList.add('special-landed');
                setTimeout(() => space.classList.remove('special-landed'), 2000);
            }

            console.log(`Player ${playerIndex} landed on space ${position}`);
            
            // Only handle card effects if this is the current player's turn
            // This prevents all clients from executing card effects simultaneously
            const isCurrentPlayer = gameData && gameData.currentPlayer === playerIndex;
            const isMyTurn = gameData && gameData.players[gameData.currentPlayer]?.name === currentPlayer;
            
            // Only the player whose turn it is should see and execute card effects
            if (!isCurrentPlayer || !isMyTurn) {
                return;
            }

            // Handle different special spaces
            switch(position) {
                case 2: // Community Chest
                case 17:
                case 33:
                    setTimeout(() => handleCommunityChest(playerIndex), 1000);
                    break;
                case 7: // Chance
                case 22:
                case 36:
                    setTimeout(() => handleChance(playerIndex), 1000);
                    break;
                case 30: // Go to Jail
                    setTimeout(() => handleGoToJail(playerIndex), 1000);
                    break;
                case 4: // Income Tax
                    handleIncomeTax(playerIndex);
                    break;
                case 38: // Super Tax
                    handleSuperTax(playerIndex);
                    break;
                case 0: // GO
                    showMessage('🎯 Welcome to GO! Collect £200', 'success');
                    break;
                case 10: // Just Visiting Jail
                case 20: // Free Parking
                    // No special action needed
                    break;
                default:
                    // Regular property space
                    break;
            }
        }

        function handleGoToJail(playerIndex) {
            // Show a humorous college-themed message
            const collegeMessage = document.createElement('div');
            collegeMessage.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #4CAF50, #45a049); 
                color: white; padding: 30px; border-radius: 20px; 
                max-width: 400px; z-index: 1002; text-align: center;
                border: 4px solid #2e7d32; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
                font-size: 18px; font-weight: bold;
            `;
            collegeMessage.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px;">🎓👮‍♂️</div>
                <div style="font-size: 20px; margin-bottom: 10px;">Go to Jail?</div>
                <div style="font-size: 16px; line-height: 1.5;">
                    "I cannot send you to Jail whilst you are at college!"
                </div>
                <div style="font-size: 14px; margin-top: 15px; opacity: 0.9;">
                    Education protects you! Stay on this space.
                </div>
            `;
            
            document.body.appendChild(collegeMessage);
            
            // Add entrance animation
            collegeMessage.style.transform = 'translate(-50%, -50%) scale(0.5)';
            collegeMessage.style.opacity = '0';
            
            setTimeout(() => {
                collegeMessage.style.transition = 'all 0.5s ease';
                collegeMessage.style.transform = 'translate(-50%, -50%) scale(1)';
                collegeMessage.style.opacity = '1';
            }, 100);
            
            // Remove message after 4 seconds
            setTimeout(() => {
                collegeMessage.style.transition = 'all 0.5s ease';
                collegeMessage.style.transform = 'translate(-50%, -50%) scale(0.5)';
                collegeMessage.style.opacity = '0';
                setTimeout(() => collegeMessage.remove(), 500);
            }, 4000);
            
            // Player stays where they are - no movement to jail
            showMessage('🎓 Education keeps you free! No jail time for students!', 'success');
        }

        function handleIncomeTax(playerIndex) {
            showMessage('💰 Income Tax - Pay £200', 'error');
            if (gameData && gameData.players[playerIndex]) {
                gameData.players[playerIndex].money = Math.max(0, gameData.players[playerIndex].money - 200);
                updatePlayersDisplay(gameData.players);
            }
        }

        function handleSuperTax(playerIndex) {
            showMessage('💰 Super Tax - Pay £100', 'error');
            if (gameData && gameData.players[playerIndex]) {
                gameData.players[playerIndex].money = Math.max(0, gameData.players[playerIndex].money - 100);
                updatePlayersDisplay(gameData.players);
            }
        }

        function updateCardsDisplay() {
            if (!gameData || !currentPlayer) return;
            
            const player = gameData.players.find(p => p.name === currentPlayer);
            if (!player) return;
            
            const cardsList = document.getElementById('cards-list');
            if (!player.cards || player.cards.length === 0) {
                cardsList.innerHTML = 'No cards held';
                return;
            }
            
            cardsList.innerHTML = player.cards.map(card => {
                const cardType = card.type.includes('Jail') ? 'chance' : 'community';
                return `<div class="card-item ${cardType}">${card.text}</div>`;
            }).join('');
        }

        // Room Management
        function createRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Please enter your name');
                return;
            }
            
            socket.emit('createRoom', { playerName });
        }

        function showJoinForm() {
            document.getElementById('join-form').classList.remove('hidden');
        }

        function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
            
            if (!playerName || !roomCode) {
                alert('Please enter your name and room code');
                return;
            }
            
            socket.emit('joinRoom', { roomCode, playerName });
        }

        function startGame() {
            socket.emit('startGame', currentRoom);
        }

        // Game Actions
        function startTurn() {
            socket.emit('startTurn', currentRoom);
        }

        function rollDice() {
            // Disable roll button during animation
            const rollBtn = document.getElementById('roll-dice-btn');
            rollBtn.disabled = true;
            rollBtn.textContent = 'Rolling...';

            // Show dice rolling animation with "?" symbols
            const diceResult = document.getElementById('dice-result');
            diceResult.innerHTML = `
                <div class="dice-container">
                    <div class="dice rolling" id="dice1">?</div>
                    <div class="dice rolling" id="dice2">?</div>
                </div>
                <div class="dice-total">Rolling dice...</div>
            `;
            diceResult.classList.remove('hidden');

            // Send actual roll request after 2 seconds of animation
            setTimeout(() => {
                socket.emit('rollDice', currentRoom);
            }, 2000);
        }

        function buyProperty() {
            if (canBuyProperty && propertyToBuy !== null) {
                const currentPlayerData = gameData.players[gameData.currentPlayer];
                const propertyIndex = currentPlayerData.position;
                socket.emit('buyProperty', { roomCode: currentRoom, propertyIndex: propertyIndex });
            }
        }

        function endTurn() {
            socket.emit('endTurn', currentRoom);
        }

        function answerQuestion(answerIndex) {
            socket.emit('answerQuestion', { roomCode: currentRoom, answerIndex });
        }

        // UI Updates
        function updatePlayersDisplay(players) {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            
            players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = `player-item ${gameData && gameData.currentPlayer === index ? 'current' : ''}`;
                playerItem.innerHTML = `
                    <div>
                        <div style="font-weight: bold;">${player.name} ${player.isHost ? '👑' : ''}</div>
                        <div style="font-size: 10px; color: #666;">${player.properties.length} properties</div>
                    </div>
                    <div class="player-money">£${player.money}</div>
                `;
                playersList.appendChild(playerItem);
            });
        }

        function updatePlayerPieces() {
            // Remove existing pieces
            document.querySelectorAll('.player-piece').forEach(piece => piece.remove());
            
            if (!gameData || !gameData.players) return;
            
            gameData.players.forEach((player, index) => {
                const piece = document.createElement('div');
                piece.className = `player-piece player-piece-${index}`;
                piece.textContent = player.name.charAt(0).toUpperCase();
                piece.title = `${player.name} - £${player.money}`;
                piece.id = `player-${index}`;
                
                // Ensure player starts at GO (position 0) if not set
                const position = player.position || 0;
                
                // Position the piece on the board
                const property = document.querySelector(`[data-index="${position}"]`);
                
                if (property) {
                    property.appendChild(piece);
                    
                    // Position multiple pieces in a circle around the center
                    const existingPieces = property.querySelectorAll('.player-piece').length;
                    if (existingPieces > 1) {
                        const angle = (existingPieces - 1) * (360 / gameData.players.length);
                        const radius = 15;
                        const x = Math.cos(angle * Math.PI / 180) * radius;
                        const y = Math.sin(angle * Math.PI / 180) * radius;
                        piece.style.left = `calc(50% + ${x}px)`;
                        piece.style.top = `calc(50% + ${y}px)`;
                    }
                }
            });
        }

        function updateTurnIndicator() {
            const indicator = document.getElementById('turn-indicator');
            if (!gameData || !gameData.gameStarted) {
                indicator.textContent = 'Waiting to start...';
                indicator.style.background = '#6c757d';
                return;
            }
            
            const currentPlayerData = gameData.players[gameData.currentPlayer];
            const isMyTurn = currentPlayerData && currentPlayerData.name === currentPlayer;
            
            indicator.textContent = isMyTurn ? 'Your Turn' : `${currentPlayerData.name}'s Turn`;
            indicator.style.background = isMyTurn ? '#ff6b6b' : '#4CAF50';
            
            // Pulse animation for current player
            if (isMyTurn) {
                indicator.style.animation = 'pulse 2s infinite';
            } else {
                indicator.style.animation = 'none';
            }
        }

        function updateGameControls() {
            const isMyTurn = gameData && gameData.players[gameData.currentPlayer]?.name === currentPlayer;
            const gamePhase = gameData?.gamePhase || 'question';
            const waitingForAnswer = gameData?.waitingForAnswer || false;
            
            // Hide all buttons first
            document.querySelectorAll('#game-controls .btn').forEach(btn => btn.classList.add('hidden'));
            
            if (!isMyTurn || !gameData?.gameStarted) return;
            
            if (gamePhase === 'question' && !waitingForAnswer) {
                document.getElementById('start-turn-btn').classList.remove('hidden');
            } else if (gamePhase === 'dice') {
                document.getElementById('roll-dice-btn').classList.remove('hidden');
                document.getElementById('dice-result').classList.add('hidden');
            } else if (gamePhase === 'property' && canBuyProperty) {
                document.getElementById('buy-property-btn').classList.remove('hidden');
                document.getElementById('end-turn-btn').classList.remove('hidden');
                
                // Highlight the property they can buy
                const currentPlayerData = gameData.players[gameData.currentPlayer];
                const propertyElement = document.querySelector(`[data-index="${currentPlayerData.position}"]`);
                if (propertyElement) {
                    propertyElement.style.boxShadow = '0 0 25px #4CAF50';
                    propertyElement.style.border = '3px solid #4CAF50';
                    propertyElement.style.transform = 'scale(1.05)';
                    propertyElement.style.zIndex = '50';
                    
                    // Remove highlight after 5 seconds or when turn ends
                    setTimeout(() => {
                        propertyElement.style.boxShadow = '';
                        propertyElement.style.border = '';
                        propertyElement.style.transform = '';
                        propertyElement.style.zIndex = '';
                    }, 5000);
                }
            } else if (gamePhase === 'endTurn') {
                document.getElementById('end-turn-btn').classList.remove('hidden');
            }
        }

        function updatePropertiesDisplay() {
            if (!gameData || !currentPlayer) return;
            
            const player = gameData.players.find(p => p.name === currentPlayer);
            if (!player) return;
            
            const propertiesList = document.getElementById('properties-list');
            if (player.properties.length === 0) {
                propertiesList.innerHTML = 'No properties owned';
                return;
            }
            
            const propertyNames = [
                'GO', 'Old Kent Road', 'Community Chest', 'Whitechapel Road', 'Income Tax',
                "King's Cross Station", 'The Angel Islington', 'Chance', 'Euston Road', 'Pentonville Road',
                'Jail', 'Pall Mall', 'Electric Company', 'Whitehall', 'Northumberland Avenue',
                'Marylebone Station', 'Bow Street', 'Community Chest', 'Marlborough Street', 'Vine Street',
                'Free Parking', 'The Strand', 'Chance', 'Fleet Street', 'Trafalgar Square',
                'Fenchurch St Station', 'Leicester Square', 'Coventry Street', 'Water Works', 'Piccadilly',
                'Go To Jail', 'Regent Street', 'Oxford Street', 'Community Chest', 'Bond Street',
                'Liverpool St Station', 'Chance', 'Park Lane', 'Super Tax', 'Mayfair'
            ];
            
            propertiesList.innerHTML = player.properties.map(propIndex => {
                const name = propertyNames[propIndex] || `Property ${propIndex}`;
                return `<div style="padding: 5px; border-left: 3px solid #4CAF50; margin: 5px 0; font-size: 11px; text-transform: none;">${name}</div>`;
            }).join('');
        }

        function updateStatsDisplay(stats) {
            const statsDisplay = document.getElementById('stats-display');
            if (!stats || !currentPlayer || !stats[currentPlayer]) {
                statsDisplay.innerHTML = '<p style="text-transform: none;">No statistics available</p>';
                return;
            }
            
            const playerStats = stats[currentPlayer];
            statsDisplay.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 11px;">
                    <div>Questions: ${playerStats.questionsAnswered}</div>
                    <div>Correct: ${playerStats.correctAnswers}</div>
                    <div>Accuracy: ${playerStats.accuracy}%</div>
                    <div>Avg Time: ${playerStats.averageTime}s</div>
                </div>
            `;
        }

        function showQuestion(question, isBonus = false) {
            console.log('showQuestion called with:', { question, isBonus });
            
            // Validate question object
            if (!question || !question.question || !question.options) {
                console.error('Invalid question object:', question);
                return;
            }
            
            const modal = document.getElementById('question-modal');
            if (!modal) {
                console.error('Question modal element not found!');
                return;
            }
            
            const questionTitle = document.getElementById('question-title');
            const questionText = document.getElementById('question-text');
            const questionOptions = document.getElementById('question-options');
            const timerValue = document.getElementById('timer-value');
            
            // Check all required elements exist
            if (!questionTitle || !questionText || !questionOptions) {
                console.error('Missing question modal elements:', {
                    questionTitle: !!questionTitle,
                    questionText: !!questionText,
                    questionOptions: !!questionOptions
                });
                return;
            }
            
            modal.classList.remove('hidden');
            console.log('Question modal should now be visible');
            
            const questionContent = document.querySelector('.question-content');
            
            // Reset classes
            if (questionContent) {
                questionContent.className = 'question-content';
            }
            
            if (isBonus) {
                // Add bonus styling
                if (question.cardType === 'chance') {
                    questionContent.classList.add('bonus-chance');
                } else {
                    questionContent.classList.add('bonus-community');
                }
                
                // Update title for bonus questions
                const title = question.cardType === 'chance' ? '❓ Chance Bonus Question' : '📦 Community Chest Bonus Question';
                questionTitle.textContent = title;
                
                // Add bonus reward notice
                const existingReward = document.getElementById('bonus-reward');
                if (existingReward) existingReward.remove();
                
                const rewardDiv = document.createElement('div');
                rewardDiv.id = 'bonus-reward';
                rewardDiv.className = 'bonus-reward';
                rewardDiv.textContent = '💰 Answer correctly to win £200!';
                
                questionText.parentNode.insertBefore(rewardDiv, questionText);
            } else {
                // Regular business question
                console.log('Setting up regular business question');
                questionTitle.textContent = '📚 Business Question';
                
                // Remove any existing bonus reward notice
                const existingReward = document.getElementById('bonus-reward');
                if (existingReward) existingReward.remove();
            }
            
            questionText.textContent = question.question;
            console.log('Question text set to:', question.question);
            
            questionOptions.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'question-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => {
                    console.log('Option clicked:', index);
                    if (isBonus) {
                        answerBonusQuestion(index, question.cardType);
                    } else {
                        answerQuestion(index);
                    }
                };
                questionOptions.appendChild(optionDiv);
            });
            
            console.log('Question options created:', question.options.length);
            
            // Start timer
            let timeLeft = question.timeLimit || 30;
            if (timerValue) {
                timerValue.textContent = timeLeft;
                
                const timerInterval = setInterval(() => {
                    timeLeft--;
                    if (timerValue) {
                        timerValue.textContent = timeLeft;
                    }
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        console.log('Question timer expired');
                    }
                }, 1000);
            }
        }

        function showBonusQuestion(question) {
            showQuestion(question, true);
        }

        function answerBonusQuestion(answerIndex, cardType) {
            socket.emit('answerBonusQuestion', { 
                roomCode: currentRoom, 
                answerIndex, 
                cardType 
            });
        }

        function hideQuestion() {
            document.getElementById('question-modal').classList.add('hidden');
        }

        function showMessage(text, type = 'success') {
            const messageDiv = document.createElement('div');
            const bgColor = type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1';
            const textColor = type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460';
            const borderColor = type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : '#bee5eb';
            
            messageDiv.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: ${bgColor}; color: ${textColor};
                padding: 15px; border-radius: 10px; 
                max-width: 300px; z-index: 1001;
                border: 2px solid ${borderColor};
                font-size: 14px; text-transform: none;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            messageDiv.textContent = text;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => messageDiv.remove(), 5000);
        }

        // Initialize Socket.IO connection
        const socket = io('https://business-monopoly-server.onrender.com');

        // Socket connection debugging
        socket.on('connect', () => {
            console.log('✅ Connected to server');
        });

        socket.on('disconnect', () => {
            console.log('❌ Disconnected from server');
        });

        // Debug all socket events
        const originalEmit = socket.emit;
        socket.emit = function(...args) {
            console.log('📤 Emitting:', args[0], args.slice(1));
            return originalEmit.apply(this, args);
        };

        // Socket Event Listeners
        socket.on('roomCreated', (roomCode) => {
            currentRoom = roomCode;
            currentPlayer = document.getElementById('playerName').value.trim();
            document.getElementById('room-code').textContent = roomCode;
            document.getElementById('room-created').classList.remove('hidden');
        });

        socket.on('roomJoined', (data) => {
            currentRoom = data.roomCode;
            currentPlayer = document.getElementById('playerName').value.trim();
            document.getElementById('room-setup').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            updatePlayersDisplay(data.players);
        });

        socket.on('playersUpdated', (players) => {
            updatePlayersDisplay(players);
            
            if (currentRoom && players.length >= 2) {
                const hostPlayer = players.find(p => p.isHost);
                if (hostPlayer && hostPlayer.name === currentPlayer) {
                    document.getElementById('start-game-btn').classList.remove('hidden');
                }
            }
        });

        socket.on('gameStarted', (room) => {
            document.getElementById('room-setup').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            gameData = room;
            
            // Ensure all players start at GO (position 0)
            gameData.players.forEach(player => {
                if (player.position === undefined) {
                    player.position = 0;
                }
            });
            
            updatePlayersDisplay(room.players);
            updateTurnIndicator();
            updateGameControls();
            updatePlayerPieces();
            updateCardsDisplay();
        });

        socket.on('gameUpdated', (room) => {
            gameData = room;
            updatePlayersDisplay(room.players);
            updateTurnIndicator();
            updateGameControls();
            
            // Only update player pieces if not currently animating movement
            if (!isPlayerMoving) {
                updatePlayerPieces();
            }
            
            updatePropertiesDisplay();
            updateCardsDisplay();
        });

        socket.on('questionReceived', (question) => {
            showQuestion(question);
        });

        socket.on('answerResult', (result) => {
            hideQuestion();
            
            const resultText = result.correct ? 
                `✅ Correct! ${result.explanation}` : 
                `❌ Wrong! ${result.explanation}`;
            
            showMessage(resultText, result.correct ? 'success' : 'error');
        });

        socket.on('diceRolled', (result) => {
            // Re-enable roll button
            const rollBtn = document.getElementById('roll-dice-btn');
            rollBtn.disabled = false;
            rollBtn.textContent = 'Roll Dice';

            // Show final dice results
            const diceResult = document.getElementById('dice-result');
            const total = result.dice[0] + result.dice[1];
            
            diceResult.innerHTML = `
                <div class="dice-container">
                    <div class="dice" id="dice1">${result.dice[0]}</div>
                    <div class="dice" id="dice2">${result.dice[1]}</div>
                </div>
                <div class="dice-total">Total: ${total} spaces</div>
            `;

            // Store movement data
            canBuyProperty = result.canBuyProperty;
            propertyToBuy = result.canBuyProperty ? result.newPosition : null;

            // Get current player data before movement
            const currentPlayerData = gameData.players[gameData.currentPlayer];
            const oldPosition = currentPlayerData.position;
            const newPosition = result.newPosition;

            // Show rent payment message if applicable (after movement completes)
            if (result.rentOwed > 0) {
                setTimeout(() => {
                    showMessage(`💰 Paid £${result.rentOwed} rent`, 'error');
                }, total * 600 + 1000);
            }

            // Show property purchase option if applicable (after movement completes)
            if (result.canBuyProperty) {
                const propertyNames = [
                    'GO', 'Old Kent Road', 'Community Chest', 'Whitechapel Road', 'Income Tax',
                    "King's Cross Station", 'The Angel Islington', 'Chance', 'Euston Road', 'Pentonville Road',
                    'Jail', 'Pall Mall', 'Electric Company', 'Whitehall', 'Northumberland Avenue',
                    'Marylebone Station', 'Bow Street', 'Community Chest', 'Marlborough Street', 'Vine Street',
                    'Free Parking', 'The Strand', 'Chance', 'Fleet Street', 'Trafalgar Square',
                    'Fenchurch St Station', 'Leicester Square', 'Coventry Street', 'Water Works', 'Piccadilly',
                    'Go To Jail', 'Regent Street', 'Oxford Street', 'Community Chest', 'Bond Street',
                    'Liverpool St Station', 'Chance', 'Park Lane', 'Super Tax', 'Mayfair'
                ];
                const propertyName = propertyNames[newPosition] || 'Property';
                
                setTimeout(() => {
                    showMessage(`🏠 You can buy ${propertyName}!`, 'info');
                }, total * 600 + 1500);
            }

            // Update the turn indicator
            updateTurnIndicator();

            // Start animated movement after short delay
            setTimeout(() => {
                isPlayerMoving = true;
                animatePlayerMovement(gameData.currentPlayer, oldPosition, newPosition, total);
            }, 1000);
        });

        socket.on('propertyPurchased', (data) => {
            showMessage(`🏠 ${data.playerName} bought ${data.propertyName} for £${data.price}`, 'info');
            
            gameData = data.gameData;
            canBuyProperty = false;
            propertyToBuy = null;
            updatePropertiesDisplay();
            updateCardsDisplay();
        });

        socket.on('statsUpdated', (stats) => {
            updateStatsDisplay(stats);
        });

        socket.on('timerTick', (timeLeft) => {
            const timerValue = document.getElementById('timer-value');
            if (timerValue) {
                timerValue.textContent = timeLeft;
            }
        });

        socket.on('error', (message) => {
            alert('Error: ' + message);
        });

        // Initialize
        document.getElementById('playerName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                createRoom();
            }
        });

        document.getElementById('roomCode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                joinRoom();
            }
        });
    </script>
</body>
</html>
