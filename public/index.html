<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Monopoly - T-Level Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .game-container {
            max-width: 1400px;
            width: 100%;
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        .monopoly-board {
            width: 800px;
            height: 800px;
            background: #f0f8f0;
            border: 8px solid #2c5f2d;
            border-radius: 10px;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 6fr 1fr;
            grid-template-rows: 1fr 6fr 1fr;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .corner {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            border: 2px solid #333;
            font-weight: bold;
            text-align: center;
            position: relative;
        }

        .corner.go {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border-radius: 10px 0 0 0;
        }

        .corner.jail {
            background: linear-gradient(45deg, #ffa500, #ffb84d);
            border-radius: 0 0 0 10px;
        }

        .corner.free-parking {
            background: linear-gradient(45deg, #4ecdc4, #6ed0ca);
            border-radius: 0 10px 0 0;
        }

        .corner.go-to-jail {
            background: linear-gradient(45deg, #ff4757, #ff6b7a);
            border-radius: 0 0 10px 0;
        }

        .board-side {
            display: flex;
        }

        .board-side.top {
            flex-direction: row-reverse;
        }

        .board-side.right {
            flex-direction: column;
        }

        .board-side.bottom {
            flex-direction: row;
        }

        .board-side.left {
            flex-direction: column-reverse;
        }

        .property {
            flex: 1;
            border: 2px solid #333;
            display: flex;
            flex-direction: column;
            font-size: 10px;
            text-align: center;
            position: relative;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .property:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .property-color {
            height: 20px;
            width: 100%;
        }

        .property-name {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            font-weight: bold;
            background: white;
        }

        .property-price {
            background: #f0f0f0;
            padding: 2px;
            font-size: 8px;
            border-top: 1px solid #ccc;
        }

        /* Property Colors */
        .brown { background-color: #8B4513; }
        .lightblue { background-color: #87CEEB; }
        .pink { background-color: #FF69B4; }
        .orange { background-color: #FFA500; }
        .red { background-color: #FF0000; }
        .yellow { background-color: #FFFF00; }
        .green { background-color: #00FF00; }
        .blue { background-color: #0000FF; }
        .station { background-color: #000000; }
        .utility { background-color: #FFD700; }

        /* Center area */
        .center {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
            border: 3px solid #333;
            border-radius: 15px;
            position: relative;
        }

        .center-logo {
            font-size: 24px;
            font-weight: bold;
            color: #2c5f2d;
            text-align: center;
            margin-bottom: 10px;
        }

        .turn-indicator {
            background: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
            min-width: 150px;
        }

        /* Game Panel */
        .game-panel {
            width: 400px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 800px;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .panel-section h3 {
            margin-bottom: 10px;
            color: #2c5f2d;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .player-item.current {
            border-left-color: #ff6b6b;
            background: #fff5f5;
        }

        .player-money {
            font-weight: bold;
            color: #27ae60;
        }

        .game-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Question Modal */
        .question-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .question-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .question-title {
            color: #2c5f2d;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .question-text {
            font-size: 18px;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .question-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .question-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .question-option:hover {
            border-color: #4CAF50;
            background: #e8f5e8;
            transform: translateY(-2px);
        }

        .timer {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .timer-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 4px solid #ddd;
            border-top: 4px solid #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Player pieces */
        .player-piece {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 10px;
            color: white;
            z-index: 100;
            transition: all 0.5s ease;
        }

        .player-piece-0 { background: #ff6b6b; }
        .player-piece-1 { background: #4ecdc4; }
        .player-piece-2 { background: #45b7d1; }
        .player-piece-3 { background: #f39c12; }
        .player-piece-4 { background: #9b59b6; }
        .player-piece-5 { background: #e74c3c; }

        /* Room setup */
        .room-setup {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 400px;
            margin: 0 auto;
        }

        .room-setup h1 {
            color: #2c5f2d;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .room-actions {
            display: flex;
            gap: 10px;
        }

        .room-code-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .room-code {
            font-size: 24px;
            font-weight: bold;
            color: #2c5f2d;
            letter-spacing: 2px;
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .game-container {
                flex-direction: column;
                align-items: center;
            }
            
            .monopoly-board {
                width: 600px;
                height: 600px;
            }
            
            .game-panel {
                width: 100%;
                max-width: 600px;
            }
        }

        @media (max-width: 768px) {
            .monopoly-board {
                width: 400px;
                height: 400px;
            }
            
            .property {
                font-size: 8px;
            }
            
            .property-color {
                height: 15px;
            }
        }

        .dice-result {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .dice {
            width: 40px;
            height: 40px;
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="room-setup" class="room-setup">
        <h1>🎓 Business Monopoly</h1>
        <p style="margin-bottom: 30px; color: #666;">T-Level Business Education Game</p>
        
        <div class="input-group">
            <label for="playerName">Your Name:</label>
            <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
        </div>
        
        <div class="room-actions">
            <button class="btn btn-primary" onclick="createRoom()">Create Room</button>
            <button class="btn btn-secondary" onclick="showJoinForm()">Join Room</button>
        </div>
        
        <div id="join-form" class="hidden" style="margin-top: 20px;">
            <div class="input-group">
                <label for="roomCode">Room Code:</label>
                <input type="text" id="roomCode" placeholder="Enter room code" maxlength="6">
            </div>
            <button class="btn btn-primary" onclick="joinRoom()">Join Game</button>
        </div>
        
        <div id="room-created" class="hidden">
            <div class="room-code-display">
                <p>Share this code with other players:</p>
                <div id="room-code" class="room-code"></div>
            </div>
            <div id="waiting-players"></div>
            <button id="start-game-btn" class="btn btn-primary hidden" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <div id="game-container" class="game-container hidden">
        <div class="monopoly-board">
            <!-- Corner: GO -->
            <div class="corner go">
                <div style="text-align: center;">
                    <div style="font-size: 16px;">🎯</div>
                    <div>GO</div>
                    <div style="font-size: 8px;">Collect £200</div>
                </div>
            </div>
            
            <!-- Top Side -->
            <div class="board-side top">
                <div class="property" data-index="39">
                    <div class="property-color blue"></div>
                    <div class="property-name">Mayfair</div>
                    <div class="property-price">£400</div>
                </div>
                <div class="property" data-index="38">
                    <div class="property-color"></div>
                    <div class="property-name">Super Tax</div>
                    <div class="property-price">£100</div>
                </div>
                <div class="property" data-index="37">
                    <div class="property-color blue"></div>
                    <div class="property-name">Park Lane</div>
                    <div class="property-price">£350</div>
                </div>
                <div class="property" data-index="36">
                    <div class="property-color"></div>
                    <div class="property-name">Chance</div>
                    <div class="property-price">❓</div>
                </div>
                <div class="property" data-index="35">
                    <div class="property-color station"></div>
                    <div class="property-name">Liverpool St</div>
                    <div class="property-price">£200</div>
                </div>
                <div class="property" data-index="34">
                    <div class="property-color green"></div>
                    <div class="property-name">Bond Street</div>
                    <div class="property-price">£320</div>
                </div>
                <div class="property" data-index="33">
                    <div class="property-color"></div>
                    <div class="property-name">Community</div>
                    <div class="property-price">📦</div>
                </div>
                <div class="property" data-index="32">
                    <div class="property-color green"></div>
                    <div class="property-name">Oxford St</div>
                    <div class="property-price">£300</div>
                </div>
                <div class="property" data-index="31">
                    <div class="property-color green"></div>
                    <div class="property-name">Regent St</div>
                    <div class="property-price">£300</div>
                </div>
            </div>
            
            <!-- Corner: Free Parking -->
            <div class="corner free-parking">
                <div style="text-align: center;">
                    <div style="font-size: 16px;">🚗</div>
                    <div>Free</div>
                    <div>Parking</div>
                </div>
            </div>
            
            <!-- Right Side -->
            <div class="board-side right">
                <div class="property" data-index="21">
                    <div class="property-color red"></div>
                    <div class="property-name">The Strand</div>
                    <div class="property-price">£220</div>
                </div>
                <div class="property" data-index="22">
                    <div class="property-color"></div>
                    <div class="property-name">Chance</div>
                    <div class="property-price">❓</div>
                </div>
                <div class="property" data-index="23">
                    <div class="property-color red"></div>
                    <div class="property-name">Fleet Street</div>
                    <div class="property-price">£220</div>
                </div>
                <div class="property" data-index="24">
                    <div class="property-color red"></div>
                    <div class="property-name">Trafalgar Sq</div>
                    <div class="property-price">£240</div>
                </div>
                <div class="property" data-index="25">
                    <div class="property-color station"></div>
                    <div class="property-name">Fenchurch St</div>
                    <div class="property-price">£200</div>
                </div>
                <div class="property" data-index="26">
                    <div class="property-color yellow"></div>
                    <div class="property-name">Leicester Sq</div>
                    <div class="property-price">£260</div>
                </div>
                <div class="property" data-index="27">
                    <div class="property-color yellow"></div>
                    <div class="property-name">Coventry St</div>
                    <div class="property-price">£260</div>
                </div>
                <div class="property" data-index="28">
                    <div class="property-color utility"></div>
                    <div class="property-name">Water Works</div>
                    <div class="property-price">£150</div>
                </div>
                <div class="property" data-index="29">
                    <div class="property-color yellow"></div>
                    <div class="property-name">Piccadilly</div>
                    <div class="property-price">£280</div>
                </div>
            </div>
            
            <!-- Corner: Go to Jail -->
            <div class="corner go-to-jail">
                <div style="text-align: center;">
                    <div style="font-size: 16px;">👮</div>
                    <div>Go To</div>
                    <div>Jail</div>
                </div>
            </div>
            
            <!-- Bottom Side -->
            <div class="board-side bottom">
                <div class="property" data-index="11">
                    <div class="property-color pink"></div>
                    <div class="property-name">Pall Mall</div>
                    <div class="property-price">£140</div>
                </div>
                <div class="property" data-index="12">
                    <div class="property-color utility"></div>
                    <div class="property-name">Electric Co</div>
                    <div class="property-price">£150</div>
                </div>
                <div class="property" data-index="13">
                    <div class="property-color pink"></div>
                    <div class="property-name">Whitehall</div>
                    <div class="property-price">£140</div>
                </div>
                <div class="property" data-index="14">
                    <div class="property-color pink"></div>
                    <div class="property-name">Northumberland</div>
                    <div class="property-price">£160</div>
                </div>
                <div class="property" data-index="15">
                    <div class="property-color station"></div>
                    <div class="property-name">Marylebone</div>
                    <div class="property-price">£200</div>
                </div>
                <div class="property" data-index="16">
                    <div class="property-color orange"></div>
                    <div class="property-name">Bow Street</div>
                    <div class="property-price">£180</div>
                </div>
                <div class="property" data-index="17">
                    <div class="property-color"></div>
                    <div class="property-name">Community</div>
                    <div class="property-price">📦</div>
                </div>
                <div class="property" data-index="18">
                    <div class="property-color orange"></div>
                    <div class="property-name">Marlborough</div>
                    <div class="property-price">£180</div>
                </div>
                <div class="property" data-index="19">
                    <div class="property-color orange"></div>
                    <div class="property-name">Vine Street</div>
                    <div class="property-price">£200</div>
                </div>
            </div>
            
            <!-- Corner: Jail -->
            <div class="corner jail">
                <div style="text-align: center;">
                    <div style="font-size: 16px;">🏢</div>
                    <div>Jail</div>
                    <div style="font-size: 8px;">Just Visiting</div>
                </div>
            </div>
            
            <!-- Left Side -->
            <div class="board-side left">
                <div class="property" data-index="1">
                    <div class="property-color brown"></div>
                    <div class="property-name">Old Kent Rd</div>
                    <div class="property-price">£60</div>
                </div>
                <div class="property" data-index="2">
                    <div class="property-color"></div>
                    <div class="property-name">Community</div>
                    <div class="property-price">📦</div>
                </div>
                <div class="property" data-index="3">
                    <div class="property-color brown"></div>
                    <div class="property-name">Whitechapel</div>
                    <div class="property-price">£60</div>
                </div>
                <div class="property" data-index="4">
                    <div class="property-color"></div>
                    <div class="property-name">Income Tax</div>
                    <div class="property-price">£200</div>
                </div>
                <div class="property" data-index="5">
                    <div class="property-color station"></div>
                    <div class="property-name">King's Cross</div>
                    <div class="property-price">£200</div>
                </div>
                <div class="property" data-index="6">
                    <div class="property-color lightblue"></div>
                    <div class="property-name">Angel Islington</div>
                    <div class="property-price">£100</div>
                </div>
                <div class="property" data-index="7">
                    <div class="property-color"></div>
                    <div class="property-name">Chance</div>
                    <div class="property-price">❓</div>
                </div>
                <div class="property" data-index="8">
                    <div class="property-color lightblue"></div>
                    <div class="property-name">Euston Road</div>
                    <div class="property-price">£100</div>
                </div>
                <div class="property" data-index="9">
                    <div class="property-color lightblue"></div>
                    <div class="property-name">Pentonville</div>
                    <div class="property-price">£120</div>
                </div>
            </div>
            
            <!-- Center -->
            <div class="center">
                <div class="center-logo">
                    🎓 BUSINESS<br>MONOPOLY
                </div>
                <div id="turn-indicator" class="turn-indicator">
                    Waiting to start...
                </div>
            </div>
        </div>
        
        <div class="game-panel">
            <div class="panel-section">
                <h3>👥 Players</h3>
                <div id="players-list" class="players-list"></div>
            </div>
            
            <div class="panel-section">
                <h3>🎮 Game Controls</h3>
                <div id="game-controls" class="game-controls">
                    <button id="start-turn-btn" class="btn btn-primary" onclick="startTurn()">Start Turn</button>
                    <button id="roll-dice-btn" class="btn btn-primary hidden" onclick="rollDice()">Roll Dice</button>
                    <button id="buy-property-btn" class="btn btn-secondary hidden" onclick="buyProperty()">Buy Property</button>
                    <button id="end-turn-btn" class="btn btn-danger hidden" onclick="endTurn()">End Turn</button>
                </div>
                <div id="dice-result" class="dice-result hidden"></div>
            </div>
            
            <div class="panel-section">
                <h3>📊 Statistics</h3>
                <div id="stats-display"></div>
            </div>
            
            <div class="panel-section">
                <h3>🏠 Properties</h3>
                <div id="properties-list">No properties owned</div>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="question-modal" class="question-modal hidden">
        <div class="question-content">
            <h2 class="question-title">📚 Business Question</h2>
            <div id="timer" class="timer">
                <div class="timer-circle">
                    <span id="timer-value">30</span>
                </div>
            </div>
            <div id="question-text" class="question-text"></div>
            <div id="question-options" class="question-options"></div>
            <div id="question-result" class="hidden"></div>
        </div>
    </div>

    <script>
        const socket = io('http://https://business-monopoly-server.onrender.com'); // Change this to your server URL
        let currentRoom = null;
        let currentPlayer = null;
        let gameData = null;
        let canBuyProperty = false;
        let propertyToBuy = null;

        // Room Management
        function createRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Please enter your name');
                return;
            }
            
            socket.emit('createRoom', { playerName });
        }

        function showJoinForm() {
            document.getElementById('join-form').classList.remove('hidden');
        }

        function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
            
            if (!playerName || !roomCode) {
                alert('Please enter your name and room code');
                return;
            }
            
            socket.emit('joinRoom', { roomCode, playerName });
        }

        function startGame() {
            socket.emit('startGame', currentRoom);
        }

        // Game Actions
        function startTurn() {
            socket.emit('startTurn', currentRoom);
        }

        function rollDice() {
            socket.emit('rollDice', currentRoom);
        }

        function buyProperty() {
            if (canBuyProperty && propertyToBuy !== null) {
                socket.emit('buyProperty', { roomCode: currentRoom, propertyIndex: propertyToBuy });
            }
        }

        function endTurn() {
            socket.emit('endTurn', currentRoom);
        }

        function answerQuestion(answerIndex) {
            socket.emit('answerQuestion', { roomCode: currentRoom, answerIndex });
        }

        // UI Updates
        function updatePlayersDisplay(players) {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            
            players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = `player-item ${gameData && gameData.currentPlayer === index ? 'current' : ''}`;
                playerItem.innerHTML = `
                    <div>
                        <div style="font-weight: bold;">${player.name} ${player.isHost ? '👑' : ''}</div>
                        <div style="font-size: 12px; color: #666;">${player.properties.length} properties</div>
                    </div>
                    <div class="player-money">£${player.money}</div>
                `;
                playersList.appendChild(playerItem);
            });
        }

        function updatePlayerPieces() {
            // Remove existing pieces
            document.querySelectorAll('.player-piece').forEach(piece => piece.remove());
            
            if (!gameData || !gameData.players) return;
            
            gameData.players.forEach((player, index) => {
                const piece = document.createElement('div');
                piece.className = `player-piece player-piece-${index}`;
                piece.textContent = player.name.charAt(0).toUpperCase();
                
                // Position the piece on the board
                const position = player.position;
                const property = document.querySelector(`[data-index="${position}"]`) || 
                                document.querySelector('.corner.go');
                
                if (property) {
                    property.appendChild(piece);
                    // Offset multiple pieces
                    const existingPieces = property.querySelectorAll('.player-piece').length;
                    piece.style.left = `${(existingPieces - 1) * 25}px`;
                }
            });
        }

        function updateTurnIndicator() {
            const indicator = document.getElementById('turn-indicator');
            if (!gameData || !gameData.gameStarted) {
                indicator.textContent = 'Waiting to start...';
                return;
            }
            
            const currentPlayerData = gameData.players[gameData.currentPlayer];
            const isMyTurn = currentPlayerData && currentPlayerData.name === currentPlayer;
            
            indicator.textContent = isMyTurn ? 'Your Turn' : `${currentPlayerData.name}'s Turn`;
            indicator.style.background = isMyTurn ? '#ff6b6b' : '#4CAF50';
        }

        function updateGameControls() {
            const isMyTurn = gameData && gameData.players[gameData.currentPlayer]?.name === currentPlayer;
            const gamePhase = gameData?.gamePhase || 'question';
            const waitingForAnswer = gameData?.waitingForAnswer || false;
            
            // Hide all buttons first
            document.querySelectorAll('#game-controls .btn').forEach(btn => btn.classList.add('hidden'));
            document.getElementById('dice-result').classList.add('hidden');
            
            if (!isMyTurn || !gameData?.gameStarted) return;
            
            if (gamePhase === 'question' && !waitingForAnswer) {
                document.getElementById('start-turn-btn').classList.remove('hidden');
            } else if (gamePhase === 'dice') {
                document.getElementById('roll-dice-btn').classList.remove('hidden');
            } else if (gamePhase === 'property' && canBuyProperty) {
                document.getElementById('buy-property-btn').classList.remove('hidden');
                document.getElementById('end-turn-btn').classList.remove('hidden');
            } else if (gamePhase === 'endTurn') {
                document.getElementById('end-turn-btn').classList.remove('hidden');
            }
        }

        function updatePropertiesDisplay() {
            if (!gameData || !currentPlayer) return;
            
            const player = gameData.players.find(p => p.name === currentPlayer);
            if (!player) return;
            
            const propertiesList = document.getElementById('properties-list');
            if (player.properties.length === 0) {
                propertiesList.innerHTML = 'No properties owned';
                return;
            }
            
            propertiesList.innerHTML = player.properties.map(propIndex => {
                // This would need the board spaces data from your backend
                return `<div style="padding: 5px; border-left: 3px solid #4CAF50; margin: 5px 0;">Property ${propIndex}</div>`;
            }).join('');
        }

        function updateStatsDisplay(stats) {
            const statsDisplay = document.getElementById('stats-display');
            if (!stats || !currentPlayer || !stats[currentPlayer]) {
                statsDisplay.innerHTML = '<p>No statistics available</p>';
                return;
            }
            
            const playerStats = stats[currentPlayer];
            statsDisplay.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
                    <div>Questions: ${playerStats.questionsAnswered}</div>
                    <div>Correct: ${playerStats.correctAnswers}</div>
                    <div>Accuracy: ${playerStats.accuracy}%</div>
                    <div>Avg Time: ${playerStats.averageTime}s</div>
                </div>
            `;
        }

        function showQuestion(question) {
            document.getElementById('question-modal').classList.remove('hidden');
            document.getElementById('question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('question-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'question-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => answerQuestion(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            // Start timer
            let timeLeft = question.timeLimit || 30;
            const timerValue = document.getElementById('timer-value');
            timerValue.textContent = timeLeft;
            
            const timerInterval = setInterval(() => {
                timeLeft--;
                timerValue.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function hideQuestion() {
            document.getElementById('question-modal').classList.add('hidden');
        }

        // Socket Event Listeners
        socket.on('roomCreated', (roomCode) => {
            currentRoom = roomCode;
            currentPlayer = document.getElementById('playerName').value.trim();
            document.getElementById('room-code').textContent = roomCode;
            document.getElementById('room-created').classList.remove('hidden');
        });

        socket.on('roomJoined', (data) => {
            currentRoom = data.roomCode;
            currentPlayer = document.getElementById('playerName').value.trim();
            document.getElementById('room-setup').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            updatePlayersDisplay(data.players);
        });

        socket.on('playersUpdated', (players) => {
            updatePlayersDisplay(players);
            
            if (currentRoom && players.length >= 2) {
                const hostPlayer = players.find(p => p.isHost);
                if (hostPlayer && hostPlayer.name === currentPlayer) {
                    document.getElementById('start-game-btn').classList.remove('hidden');
                }
            }
        });

        socket.on('gameStarted', (room) => {
            document.getElementById('room-setup').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            gameData = room;
            updatePlayersDisplay(room.players);
            updateTurnIndicator();
            updateGameControls();
            updatePlayerPieces();
        });

        socket.on('gameUpdated', (room) => {
            gameData = room;
            updatePlayersDisplay(room.players);
            updateTurnIndicator();
            updateGameControls();
            updatePlayerPieces();
            updatePropertiesDisplay();
        });

        socket.on('questionReceived', (question) => {
            showQuestion(question);
        });

        socket.on('answerResult', (result) => {
            hideQuestion();
            
            const resultText = result.correct ? 
                `✅ Correct! ${result.explanation}` : 
                `❌ Wrong! ${result.explanation}`;
            
            const resultDiv = document.createElement('div');
            resultDiv.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: ${result.correct ? '#d4edda' : '#f8d7da'}; 
                color: ${result.correct ? '#155724' : '#721c24'};
                padding: 15px; border-radius: 10px; 
                max-width: 300px; z-index: 1001;
                border: 2px solid ${result.correct ? '#c3e6cb' : '#f5c6cb'};
            `;
            resultDiv.textContent = resultText;
            document.body.appendChild(resultDiv);
            
            setTimeout(() => resultDiv.remove(), 5000);
        });

        socket.on('diceRolled', (result) => {
            const diceResult = document.getElementById('dice-result');
            diceResult.innerHTML = `
                <div class="dice">${result.dice[0]}</div>
                <div class="dice">${result.dice[1]}</div>
                <div style="margin-left: 10px;">Total: ${result.dice[0] + result.dice[1]}</div>
            `;
            diceResult.classList.remove('hidden');
            
            canBuyProperty = result.canBuyProperty;
            propertyToBuy = result.canBuyProperty ? gameData.players[gameData.currentPlayer].position : null;
            
            if (result.passedGo) {
                const goMessage = document.createElement('div');
                goMessage.style.cssText = `
                    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
                    background: #d4edda; color: #155724; padding: 15px; 
                    border-radius: 10px; z-index: 1001; border: 2px solid #c3e6cb;
                `;
                goMessage.textContent = '🎯 Passed GO! Collect £200';
                document.body.appendChild(goMessage);
                setTimeout(() => goMessage.remove(), 3000);
            }
            
            if (result.rentOwed > 0) {
                const rentMessage = document.createElement('div');
                rentMessage.style.cssText = `
                    position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
                    background: #f8d7da; color: #721c24; padding: 15px; 
                    border-radius: 10px; z-index: 1001; border: 2px solid #f5c6cb;
                `;
                rentMessage.textContent = `💰 Paid £${result.rentOwed} rent`;
                document.body.appendChild(rentMessage);
                setTimeout(() => rentMessage.remove(), 3000);
            }
            
            setTimeout(() => {
                updatePlayerPieces();
                updateGameControls();
            }, 500);
        });

        socket.on('propertyPurchased', (data) => {
            const purchaseMessage = document.createElement('div');
            purchaseMessage.style.cssText = `
                position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
                background: #d1ecf1; color: #0c5460; padding: 15px; 
                border-radius: 10px; z-index: 1001; border: 2px solid #bee5eb;
            `;
            purchaseMessage.textContent = `🏠 ${data.playerName} bought ${data.propertyName} for £${data.price}`;
            document.body.appendChild(purchaseMessage);
            setTimeout(() => purchaseMessage.remove(), 3000);
            
            gameData = data.gameData;
            canBuyProperty = false;
            propertyToBuy = null;
        });

        socket.on('statsUpdated', (stats) => {
            updateStatsDisplay(stats);
        });

        socket.on('timerTick', (timeLeft) => {
            const timerValue = document.getElementById('timer-value');
            if (timerValue) {
                timerValue.textContent = timeLeft;
            }
        });

        socket.on('error', (message) => {
            alert('Error: ' + message);
        });

        // Initialize
        document.getElementById('playerName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                createRoom();
            }
        });

        document.getElementById('roomCode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                joinRoom();
            }
        });
    </script>
</body>
</html>
